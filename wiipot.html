<!doctype html>
<html lang="sl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JACKPOT - WIIPOT</title>
<style>
  :root{--bg:#f5f7fb;--card:#fff;--accent:#2b6cb0;--danger:#e53e3e;--muted:#666}
  body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:var(--bg);color:#111}
  header{background:linear-gradient(90deg,#1e90ff22,#ffffff);padding:18px 20px;border-bottom:1px solid #e6eefc;display:flex;align-items:center;justify-content:space-between}
  header h1{margin:0;font-size:20px}
  .small{font-size:13px;color:var(--muted)}
  .container{max-width:1100px;margin:20px auto;padding:12px}
  .top-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
  .card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(20,40,80,0.06)}
  .login-info{display:flex;gap:10px;align-items:center}
  button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  button.ghost{background:transparent;color:var(--accent);border:1px solid #cfe3fb}
  button.danger{background:var(--danger)}
  .grid{display:grid;grid-template-columns:repeat(10,1fr);gap:6px;padding:8px}
  .cell{background:#f7fbff;border:1px dashed #dbeffd;padding:10px;text-align:center;border-radius:6px;cursor:pointer;user-select:none;transition:all .2s}
  .cell.reserved{background:#ffeccf;border:1px solid #ffd689;cursor:not-allowed}
  .cell.winner{box-shadow:0 0 0 3px rgba(255,215,0,0.12) inset}
  .cell.multi-select{background:#c8facc!important;border-color:#6ee7b7!important}
  .controls{display:flex;gap:8px;align-items:center}
  .badge{background:#eef6ff;color:#0b3a66;padding:6px 8px;border-radius:999px;font-weight:600}
  .panel{display:flex;gap:12px;flex-wrap:wrap}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;border-bottom:1px solid #eef2fb;text-align:left}
  th{background:#fbfdff;font-weight:700}
  .muted{color:var(--muted);font-size:13px}
  .center{text-align:center}
  .input, input, select{padding:8px;border-radius:6px;border:1px solid #dfe9fb}
  .footer-note{font-size:13px;color:var(--muted);margin-top:8px}
  @media(max-width:800px){.grid{grid-template-columns:repeat(5,1fr)}}
</style>
</head>
<body>
<header>
  <div>
    <h1>JACKPOT ‚Äî WIIPOT</h1>
    <div class="small">Sistem za rezervacijo ≈°tevil in ≈ærebanje</div>
  </div>
  <div id="userArea" class="login-info"></div>
</header>

<div class="container">

  <div class="top-row">
    <div class="card" style="flex:1">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div>
          <div class="small">Zaposleni:</div>
          <div id="loggedName"><strong>niste prijavljeni</strong></div>
        </div>

        <div class="controls">
          <button id="btnLogin">Prijava</button>
          <button id="btnLogout" class="ghost" style="display:none">Odjava</button>
        </div>
      </div>
      <div class="footer-note">Kode: <code>000</code> = Ja≈°a (manager), <code>142</code> = Tinkara</div>
    </div>

    <div class="card" style="width:320px">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div>
          <div class="small">≈Ωrebanje (manager)</div>
          <div class="muted">≈†tevilo iz≈ærebanih ≈°tevil:</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="numWinners" type="number" class="input" value="5" min="1" max="100" style="width:80px"/>
          <button id="btnDraw">≈ΩREB</button>
        </div>
      </div>
    </div>

    <div class="card" style="width:240px">
      <div>
        <div class="small">Manager orodja:</div>
        <button id="btnMassReserve" style="margin-top:6px;display:none">Mno≈æiƒçna rezervacija</button>
        <button id="btnReset" class="danger" style="display:none;margin-top:6px">PONASTAVI</button>
      </div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong>Polje ≈°tevil (1‚Äì100)</strong>
        <div class="muted">Klikni na ≈°tevilo, da ga rezervira≈° (samo prijavljeni).</div>
      </div>
      <div class="panel">
        <div class="small">Iskanje stranke:</div>
        <input id="searchCustomer" list="customersList" placeholder="ime in priimek" class="input" style="min-width:220px"/>
        <datalist id="customersList"></datalist>
        <div class="badge" id="reservedCount">Rezerviranih: 0</div>
      </div>
    </div>
    <hr style="margin:12px 0;border:none;border-top:1px solid #f0f6ff"/>
    <div id="grid" class="grid"></div>
  </div>

  <div class="card" id="afterDraw" style="display:none">
    <h3>Rezultati ≈æreba</h3>
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">
      <div class="small">Iz≈ærebane ≈°tevilke:</div>
      <div id="winnersList" style="display:flex;gap:8px;flex-wrap:wrap"></div>
    </div>

    <table>
      <thead>
        <tr>
          <th>Stranka</th>
          <th>Rezervirane ≈°tevilke</th>
          <th>Nagrajene ≈°tevilke</th>
          <th>Odstotek</th>
          <th>Opomba</th>
        </tr>
      </thead>
      <tbody id="resultsTable"></tbody>
    </table>
  </div>

  <div class="card">
    <h3>Seznam rezervacij</h3>
    <table>
      <thead><tr><th>≈†t.</th><th>Stranka</th><th>Kdaj</th></tr></thead>
      <tbody id="reservationsTable"></tbody>
    </table>
  </div>

</div>

<!-- Modal -->
<div id="modal" style="position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.4)">
  <div style="background:white;padding:16px;border-radius:10px;width:400px;max-width:95%" class="card">
    <div id="modalContent"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="modalCancel" class="ghost">Prekliƒçi</button>
      <button id="modalOk">V redu</button>
    </div>
  </div>
</div>

<script>
const EMPLOYEES={"000":{name:"Ja≈°a Petrinjak",role:"manager"},"142":{name:"Tinkara Jelen",role:"employee"}};
const STORAGE_KEYS={reservations:"jackpot_reservations_v2",customers:"jackpot_customers_v2",lastDraw:"jackpot_lastdraw_v2"};
let currentUser=null;
let reservations=loadJSON(STORAGE_KEYS.reservations,{});
let customers=loadJSON(STORAGE_KEYS.customers,[]);
let lastDraw=loadJSON(STORAGE_KEYS.lastDraw,null);

const gridEl=document.getElementById("grid");
const reservedCountEl=document.getElementById("reservedCount");
const customersList=document.getElementById("customersList");
const searchCustomer=document.getElementById("searchCustomer");
const loggedName=document.getElementById("loggedName");
const btnLogin=document.getElementById("btnLogin");
const btnLogout=document.getElementById("btnLogout");
const btnDraw=document.getElementById("btnDraw");
const numWinners=document.getElementById("numWinners");
const afterDraw=document.getElementById("afterDraw");
const winnersList=document.getElementById("winnersList");
const resultsTable=document.getElementById("resultsTable");
const reservationsTable=document.getElementById("reservationsTable");
const btnReset=document.getElementById("btnReset");
const btnMassReserve=document.getElementById("btnMassReserve");
const modal=document.getElementById("modal");
const modalContent=document.getElementById("modalContent");
const modalOk=document.getElementById("modalOk");
const modalCancel=document.getElementById("modalCancel");

let multiReserveMode=false;
let multiReserveName="";
let selectedNumbers=[];

renderGrid();refreshUI();renderCustomersDatalist();renderReservationsTable();if(lastDraw)renderDrawResults(lastDraw);

btnLogin.onclick=()=>showLoginModal();
btnLogout.onclick=()=>{currentUser=null;refreshUI();};
btnMassReserve.onclick=()=>startMassReserve();

function showLoginModal(){
  openModal(`<h3>Prijava</h3><div class="small">Vnesi kodo:</div><input id="pinInput" class="input" style="width:100%;margin-top:8px"/>`,"Prijavi",()=>{
    const code=document.getElementById("pinInput").value.trim();
    if(EMPLOYEES[code]){currentUser={code,...EMPLOYEES[code]};refreshUI();}else alert("Napaƒçna koda");
  });
}

function openModal(html,okText,onOk){
  modalContent.innerHTML=html;
  modal.style.display="flex";
  modalOk.textContent=okText||"V redu";
  modalOk.onclick=()=>{modal.style.display="none";onOk&&onOk();};
  modalCancel.onclick=()=>modal.style.display="none";
}

/* GRID */
function renderGrid(){
  gridEl.innerHTML="";
  for(let i=1;i<=100;i++){
    const cell=document.createElement("div");
    cell.className="cell";
    cell.textContent=i;
    if(reservations[i]) cell.classList.add("reserved");
    if(lastDraw && lastDraw.winners.includes(i)) cell.classList.add("winner");
    cell.onclick=()=>onCellClick(i,cell);
    gridEl.appendChild(cell);
  }
  updateReservedCount();
}

function onCellClick(num,cell){
  if(multiReserveMode){
    if(reservations[num])return;
    if(selectedNumbers.includes(num)){
      selectedNumbers=selectedNumbers.filter(n=>n!==num);
      cell.classList.remove("multi-select");
    }else{
      selectedNumbers.push(num);
      cell.classList.add("multi-select");
    }
    return;
  }

  if(!currentUser){alert("Rezervacija ni mogoƒça brez prijave!");return;}
  if(reservations[num]){
    const r=reservations[num];
    openModal(`<h3>≈†t. ${num} je rezervirana</h3><div>Stranka: <strong>${r.name}</strong></div>`,"OK");
    return;
  }
  const prefill=(searchCustomer.value||"").trim();
  openModal(`<h3>Rezervacija ≈°t. ${num}</h3><div class="small">Ime in priimek:</div><input id="custName" class="input" value="${prefill}" style="width:100%;margin-top:8px"/>`,"Rezerviraj",()=>{
    const name=document.getElementById("custName").value.trim();
    if(!name){alert("Vnesi ime!");return;}
    reservations[num]={name,ts:Date.now()};
    if(!customers.includes(name)){customers.push(name);saveJSON(STORAGE_KEYS.customers,customers);renderCustomersDatalist();}
    saveJSON(STORAGE_KEYS.reservations,reservations);
    renderGrid();updateReservedCount();renderReservationsTable();
  });
}

/* MNO≈ΩIƒåNA REZERVACIJA */
function startMassReserve(){
  if(!currentUser||currentUser.role!=="manager"){alert("Samo manager lahko izvaja mno≈æiƒçno rezervacijo.");return;}
  openModal(`<h3>Mno≈æiƒçna rezervacija</h3><div class="small">Ime stranke:</div><input id="massName" class="input" placeholder="ime in priimek" style="width:100%;margin-top:8px"/>`,"Naprej",()=>{
    const name=document.getElementById("massName").value.trim();
    if(!name){alert("Vnesi ime!");return;}
    multiReserveMode=true;
    multiReserveName=name;
    selectedNumbers=[];
    alert("Zdaj klikaj na proste ≈°tevilke, ki jih ≈æeli≈° rezervirati za: "+name+". Ko konƒça≈°, pritisni ≈°e enkrat na 'Mno≈æiƒçna rezervacija' za potrditev.");
    btnMassReserve.textContent="‚úÖ Potrdi mno≈æiƒçno rezervacijo";
    btnMassReserve.onclick=()=>finishMassReserve();
  });
}

function finishMassReserve(){
  if(selectedNumbers.length===0){alert("Nisi izbral nobene ≈°tevilke.");return;}
  selectedNumbers.forEach(num=>{
    reservations[num]={name:multiReserveName,ts:Date.now()};
  });
  if(!customers.includes(multiReserveName)){customers.push(multiReserveName);saveJSON(STORAGE_KEYS.customers,customers);}
  saveJSON(STORAGE_KEYS.reservations,reservations);
  multiReserveMode=false;
  selectedNumbers=[];
  btnMassReserve.textContent="Mno≈æiƒçna rezervacija";
  btnMassReserve.onclick=()=>startMassReserve();
  renderGrid();renderReservationsTable();updateReservedCount();
  alert("Mno≈æiƒçna rezervacija za '"+multiReserveName+"' uspe≈°no izvedena.");
}

/* ≈ΩREB + ostalo */
btnDraw.onclick=()=>{if(!currentUser)return showManagerApprove(()=>performDraw());if(currentUser.role!=="manager")return showManagerApprove(()=>performDraw());performDraw();};
btnReset.onclick=()=>{if(!currentUser||currentUser.role!=="manager"){alert("Samo manager lahko ponastavi.");return;}if(!confirm("Res ≈æelite ponastaviti igro?"))return;reservations={};saveJSON(STORAGE_KEYS.reservations,reservations);lastDraw=null;saveJSON(STORAGE_KEYS.lastDraw,null);renderGrid();renderReservationsTable();afterDraw.style.display="none";alert("Igra ponastavljena.");};

function performDraw(){const n=parseInt(numWinners.value)||5;const winners=randomUnique(n,1,100);lastDraw={winners,timestamp:Date.now()};saveJSON(STORAGE_KEYS.lastDraw,lastDraw);renderDrawResults(lastDraw);btnReset.style.display="inline-block";}
function renderDrawResults(draw){afterDraw.style.display="block";winnersList.innerHTML="";draw.winners.forEach(w=>{const el=document.createElement("div");el.className="badge";el.style.background="#fff9db";el.style.color="#8a5a00";el.textContent=w;winnersList.appendChild(el);});const byCustomer={};for(const [numStr,data]of Object.entries(reservations)){const num=parseInt(numStr);if(!byCustomer[data.name])byCustomer[data.name]={reserved:[],won:[]};byCustomer[data.name].reserved.push(num);if(draw.winners.includes(num))byCustomer[data.name].won.push(num);}resultsTable.innerHTML="";const names=Object.keys(byCustomer).sort();if(names.length===0){resultsTable.innerHTML=`<tr><td colspan="5" class="center muted">Ni rezervacij</td></tr>`;return;}names.forEach(name=>{const d=byCustomer[name];const pct=(d.reserved.length?Math.round((d.won.length/d.reserved.length)*100):0);const eligible=(d.won.length/d.reserved.length)>1/3;const tr=document.createElement("tr");tr.innerHTML=`<td>${name}</td><td>${d.reserved.sort((a,b)=>a-b).join(", ")}</td><td>${d.won.sort((a,b)=>a-b).join(", ")||"-"}</td><td>${pct}%</td><td>${eligible?"üéâ Nagrada za "+d.won.length+" ≈°t.":"-"}</td>`;resultsTable.appendChild(tr);});renderGrid();}

function renderReservationsTable(){const tbody=reservationsTable;tbody.innerHTML="";const entries=Object.entries(reservations).sort((a,b)=>a[0]-b[0]);entries.forEach(([num,data])=>{const tr=document.createElement("tr");const d=new Date(data.ts).toLocaleString("sl-SI");tr.innerHTML=`<td>${num}</td><td>${data.name}</td><td>${d}</td>`;tbody.appendChild(tr);});if(entries.length===0)tbody.innerHTML=`<tr><td colspan="3" class="center muted">Ni rezervacij</td></tr>`;}
function renderCustomersDatalist(){customersList.innerHTML="";customers.forEach(c=>{const o=document.createElement("option");o.value=c;customersList.appendChild(o);});}
function refreshUI(){loggedName.textContent=currentUser?currentUser.name+" ("+currentUser.role+")":"niste prijavljeni";btnLogin.style.display=currentUser?"none":"inline-block";btnLogout.style.display=currentUser?"inline-block":"none";btnReset.style.display=(currentUser&&currentUser.role==="manager")?"inline-block":"none";btnMassReserve.style.display=(currentUser&&currentUser.role==="manager")?"inline-block":"none";}
function updateReservedCount(){reservedCountEl.textContent="Rezerviranih: "+Object.keys(reservations).length;}
function showManagerApprove(cb){openModal(`<h3>Dovoljenje managerja</h3><div class="small">Vnesi managersko kodo:</div><input id="mgrPin" class="input" style="width:100%;margin-top:8px"/>`,"Potrdi",()=>{const code=document.getElementById("mgrPin").value.trim();if(EMPLOYEES[code]?.role==="manager"){cb();}else alert("Dostop zavrnjen");});}

/* Helpers */
function saveJSON(k,v){localStorage.setItem(k,JSON.stringify(v));}
function loadJSON(k,def){try{return JSON.parse(localStorage.getItem(k))||def;}catch{return def;}}
function randomUnique(count,min,max){const arr=[];while(arr.length<count){const n=Math.floor(Math.random()*(max-min+1))+min;if(!arr.includes(n))arr.push(n);}return arr;}
</script>
</body>
</html>
